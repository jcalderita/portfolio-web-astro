---
title: "Swift Package"
slug: "swift-package-es"
date: 2025-12-15
author: "Jorge Calderita"
description: "Gu√≠a completa sobre los comandos de limpieza de Swift Package Manager: clean, reset, purge-cache y cu√°ndo usar cada uno para resolver problemas de dependencias."
tags: ["Swift", "Vapor"]
cover: "../images/SwiftPackage.png"
publicCover: "SwiftPackage.webp"
coverDescription: "Comandos de limpieza en Swift Package Manager"
publish: false
---

## El dilema de las dependencias rotas

Cuando trabajas con **Swift Package Manager (SPM)**, eventualmente te encontrar√°s con un error de compilaci√≥n que parece no tener sentido. Has intentado compilar varias veces, has reiniciado Xcode, pero el error persiste. La soluci√≥n muchas veces est√° en **limpiar correctamente las cach√©s y artefactos** de SPM, pero ¬øqu√© comando usar?

Existen m√∫ltiples formas de "limpiar" en SPM, cada una con un prop√≥sito espec√≠fico. Usar el comando equivocado puede no resolver tu problema o, peor a√∫n, forzarte a descargar gigabytes de dependencias nuevamente.

---

## Los cuatro caminos para limpiar

SPM ofrece tres comandos oficiales m√°s una alternativa manual. Cada uno afecta diferentes partes del sistema:

| Comando | Elimina .build local | Elimina Package.resolved | Elimina cach√© global |
|---------|---------------------|-------------------------|---------------------|
| <span class="high">swift package clean</span> | ‚ùå (solo binarios compilados) | ‚ùå | ‚ùå |
| <span class="high">swift package reset</span> | ‚úÖ (completo) | ‚úÖ | ‚ùå |
| <span class="high">swift package purge-cache</span> | ‚ùå | ‚ùå | ‚úÖ |
| <span class="high">rm -rf .build</span> | ‚úÖ (completo) | ‚ùå | ‚ùå |

### Swift package clean

```bash
swift package clean
```

**Qu√© hace:**
Elimina √∫nicamente los **binarios compilados finales** dentro de la carpeta <span class="high">.build</span>, pero **mantiene dependencias descargadas y archivos intermedios**.

**Cu√°ndo usarlo:**
- Despu√©s de cambiar configuraciones de compilaci√≥n
- Para forzar una recompilaci√≥n completa sin re-descargar dependencias
- Cuando los binarios est√°n corruptos pero las fuentes est√°n bien

> üí° No descarga dependencias nuevamente ni resuelve problemas de cach√© de paquetes.

### Swift package reset

```bash
swift package reset
```

**Qu√© hace:**
Elimina **completamente** la carpeta <span class="high">.build</span> (incluyendo dependencias descargadas) y el archivo <span class="high">Package.resolved</span>.

**Cu√°ndo usarlo:**
- Cuando hay conflictos en las versiones de dependencias
- Despu√©s de cambios importantes en <span class="high">Package.swift</span>
- Para resolver errores de "dependencia no encontrada"
- Cuando <span class="high">Package.resolved</span> est√° desactualizado o corrupto

> ‚ö†Ô∏è La pr√≥xima compilaci√≥n descargar√° y resolver√° todas las dependencias desde cero. Esto puede tardar varios minutos dependiendo de la cantidad de paquetes.

### Swift package purge-cache

```bash
swift package purge-cache
```

üí° Disponible desde Swift 5.7 en adelante.

**Qu√© hace:**
Elimina la **cach√© global de paquetes** ubicada en:
```
~/Library/Caches/org.swift.swiftpm/
```

Esta cach√© contiene repositorios clonados y artefactos binarios compartidos entre todos tus proyectos.

**Cu√°ndo usarlo:**
- Cuando m√∫ltiples proyectos tienen el mismo problema
- Despu√©s de actualizar Xcode o herramientas de Swift
- Para liberar espacio en disco (puede ocupar varios GB)
- Cuando sospechas que la cach√© global est√° corrupta

> ‚ö†Ô∏è Todos tus proyectos tendr√°n que re-descargar dependencias comunes.

### rm -rf .build

```bash
rm -rf .build
```

**Qu√© hace:**
Elimina manualmente la carpeta <span class="high">.build</span> completa, similar a <span class="high">reset</span> pero **sin tocar** <span class="high">Package.resolved</span>. Es menos agresivo que reset porque no re-resuelve dependencias.

**Cu√°ndo usarlo:**
- Para limpiar artefactos de compilaci√≥n manteniendo la resoluci√≥n de versiones
- En scripts de CI/CD donde quieres control total
- Cuando <span class="high">swift package reset</span> no est√° disponible

> üí° Preserva <span class="high">Package.resolved</span>, lo que significa que las versiones de dependencias no se re-resolver√°n.

---

## Estrategia de resoluci√≥n de problemas

**Nivel 1: Limpieza ligera**
```bash
swift package clean
```
> üí° Prueba primero lo menos invasivo. Resuelve el 30% de los problemas.

**Nivel 2: Reset completo del proyecto**
```bash
swift package reset
```
> üí° Si el nivel 1 falla. Resuelve el 60% de los problemas restantes.

**Nivel 3: Purgar cach√© global**
```bash
swift package purge-cache
swift package reset
```
> üí° Para problemas persistentes o que afectan m√∫ltiples proyectos.

**Nivel 4: Nuclear**
```bash
rm -rf .build
rm Package.resolved
swift package purge-cache
```
> üí° √öltima opci√≥n. Borr√≥n y cuenta nueva total.

---

## Casos de uso reales

### Escenario 1: Error despu√©s de actualizar Xcode
```bash
swift package purge-cache
swift package reset
```

> üí° Las herramientas de compilaci√≥n cambiaron y la cach√© puede tener artefactos incompatibles.

### Escenario 2: Conflicto de versiones de dependencias
```bash
swift package reset
```

> üí° Necesitas re-resolver todas las dependencias con las nuevas restricciones.

### Escenario 3: Espacio en disco lleno
```bash
swift package purge-cache
```

> üí° La cach√© global puede crecer hasta varios GB sin que lo notes.

### Escenario 4: CI/CD builds
```bash
rm -rf .build
```

> üí° En entornos de integraci√≥n continua, quieres builds limpios pero reproducibles con `Package.resolved` versionado.

---

## Entendiendo los componentes

### .build (local)
- Artefactos de compilaci√≥n del proyecto actual
- Dependencias descargadas espec√≠ficas del proyecto
- Archivos intermedios de compilaci√≥n

### Package.resolved
- "Lockfile" que fija versiones exactas de dependencias
- Garantiza builds reproducibles
- Debe versionarse en Git para proyectos compartidos

### Cach√© global
- Compartida entre todos tus proyectos Swift
- Contiene clones de repositorios de dependencias
- Artefactos binarios pre-compilados
- Puede alcanzar varios GB con el tiempo

---

## Mejores pr√°cticas

‚úÖ **Versiona** <span class="high">Package.resolved</span> en Git para garantizar que todo el equipo use las mismas versiones

‚úÖ **Usa** <span class="high">reset</span> **despu√©s de cambios en Package.swift** para asegurar una resoluci√≥n limpia

‚úÖ **Purga la cach√© peri√≥dicamente** si trabajas con muchos proyectos

‚úÖ **En CI/CD, mant√©n** <span class="high">Package.resolved</span> pero elimina <span class="high">.build</span> para builds limpios

‚ùå **No ignores** <span class="high">.build</span> **en .gitignore** - ya est√° ignorado por defecto

‚ùå **No borres** <span class="high">Package.resolved</span> a menos que realmente necesites re-resolver versiones

---

## Conclusi√≥n

Entender la diferencia entre estos comandos te ahorra tiempo y frustraci√≥n. No todos los problemas de compilaci√≥n necesitan una limpieza nuclear:

- <span class="high">clean</span> ‚Üí Solo binarios compilados
- <span class="high">reset</span> ‚Üí Proyecto completo + Package.resolved
- <span class="high">purge-cache</span> ‚Üí Cach√© global compartida
- <span class="high">rm -rf</span> ‚Üí Control manual quir√∫rgico

La pr√≥xima vez que SPM te muestre un error extra√±o, ya sabes exactamente qu√© herramienta usar.

---
