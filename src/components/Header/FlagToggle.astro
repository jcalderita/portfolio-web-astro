---
interface Props {
  language: string;
}

const { language } = Astro.props;
const targetLanguage = language === "es" ? "en" : "es";
const flag = language === "es" ? "ğŸ‡ºğŸ‡¸" : "ğŸ‡ªğŸ‡¸";
const ariaLabel = language === "es" ? "Cambiar a inglÃ©s" : "Switch to Spanish";
const title = language === "es" ? "Cambiar el idioma de la web a inglÃ©s" : "Switch website language to Spanish";
const currentPath = Astro.url.pathname;
const url = currentPath.replace(`/${language}/`, `/${targetLanguage}/`).replace(`-${language}`, `-${targetLanguage}`);
console.log(url);
---

<a id="flag-toggle" href={url} class="cursor-pointer text-3xl" title={title} aria-label={ariaLabel} data-language={targetLanguage}>
  <span aria-hidden="true">{flag}</span>
</a>

<script is:inline>
  function initFlagToggle(doc = document) {
    const flagToggle = doc.getElementById("flag-toggle");
    if (flagToggle) {
      flagToggle.addEventListener("click", function () {
        const lang = flagToggle.dataset.language;
        document.cookie = `lang=${encodeURIComponent(lang)}; path=/; max-age=31536000`;
      });
    }
  }

  initFlagToggle(document);

  document.addEventListener("astro:before-swap", (ev) => {
    initFlagToggle(ev.newDocument);
  });
</script>
